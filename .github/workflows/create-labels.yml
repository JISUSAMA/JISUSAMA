name: Create GitHub Labels

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  push:
    paths:
      - .github/labels.json # ì´ íŒŒì¼ì´ ë³€ê²½ë  ë•Œ ìë™ ì‹¤í–‰

jobs:
  create-labels:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Create labels using GitHub API
        run: |
          LABELS_FILE=".github/labels.json"

          # ë””ë²„ê¹… ì‹œì‘
          echo "ğŸ“¦ Loading labels from $LABELS_FILE..."
          cat "$LABELS_FILE"

          jq -c '.[]' "$LABELS_FILE" | while read -r row; do
            name=$(echo "$row" | jq -r '.name')
            color=$(echo "$row" | jq -r '.color')
            description=$(echo "$row" | jq -r '.description')

            echo "ğŸ‘‰ Creating: $name / $color / $description"

            response=$(curl -s -X POST \
              -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
              -H "Accept: application/vnd.github+json" \
              https://api.github.com/repos/${{ github.repository }}/labels \
              -d "{\"name\":\"$name\", \"color\":\"$color\", \"description\":\"$description\"}")

            echo "ğŸ” Response from GitHub:"
            echo "$response"

            created=$(echo "$response" | jq -r '.name')
            if [[ "$created" == "null" ]]; then
              echo "âŒ Failed to create: $name"
            else
              echo "âœ… Created: $created"
            fi
          done
